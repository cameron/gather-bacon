/*! grafana - v1.5.2 - 2014-03-24
 * Copyright (c) 2014 Torkel Ã–degaard; Licensed Apache License */

define("panels/filtering/module",["angular","app","underscore"],function(a,b,c){var d=a.module("kibana.panels.filtering",[]);b.useModule(d),d.controller("filtering",["$scope","filterSrv","datasourceSrv","$rootScope","dashboard",function(a,b,d,e,f){function g(a){return 0===a.length?!1:"*"===a[a.length-1]}a.panelMeta={status:"Stable",description:"graphite target filters"};var h={};c.defaults(a.panel,h),a.init=function(){a.filterList=b.list},a.remove=function(a){b.remove(a)},a.filterOptionSelected=function(c,d){b.filterOptionSelected(c,d),a.applyFilterToOtherFilters(c)},a.applyFilterToOtherFilters=function(b){c.each(a.filterList,function(c){c!==b&&-1!==c.query.indexOf(b.name)&&a.applyFilter(c)})},a.applyFilter=function(a){var e=b.applyFilterToTarget(a.query);d.default.metricFindQuery(e).then(function(d){if(a.editing=void 0,a.options=c.map(d,function(a){return{text:a.text,value:a.text}}),a.includeAll)if(g(a.query))a.options.unshift({text:"All",value:"*"});else{var e="{";c.each(a.options,function(a){e+=a.text+","}),e=e.substring(0,e.length-1)+"}",a.options.unshift({text:"All",value:e})}b.filterOptionSelected(a,a.options[0])})},a.add=function(){b.add({type:"filter",name:"filter name",editing:!0,query:"metric.path.query.*"})},a.refresh=function(){f.refresh()},a.render=function(){e.$broadcast("render")}}])});